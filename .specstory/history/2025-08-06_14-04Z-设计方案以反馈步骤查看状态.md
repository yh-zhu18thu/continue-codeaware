<!-- Generated by SpecStory -->

# 设计方案以反馈步骤查看状态 (2025-08-06 14:04Z)

_**User**_

我希望通过一些界面设计来向用户反馈step是否被展开查看过（可根据knowledgeCardGenerationStatus判断），使得用户记得自己查看过哪些step，请你根据当前已有的设计给出一些合理的设计方案来反映这个信息

---

_**Assistant**_

根据当前的设计，我可以提供几种合理的方案来反映step是否被展开查看过。以下是一些设计建议：

## 方案1：左侧指示器 + 透明度变化（推荐）

在标题栏左侧添加一个小圆点指示器，同时调整整体透明度：

````tsx
// ...existing code...

const ViewedIndicator = styled.div<{ isViewed: boolean }>`
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background-color: ${({ isViewed }) => isViewed ? '#22C55E' : 'transparent'};
  border: 1px solid ${({ isViewed }) => isViewed ? '#22C55E' : '#666666'};
  margin-right: 8px;
  transition: all 0.2s ease-in-out;
`;

const TitleBarContainer = styled.div<{ 
  isActive: boolean; 
  isExpanded: boolean; 
  isHighlighted: boolean; 
  isFlickering: boolean; 
  stepStatus?: StepStatus;
  isViewed?: boolean; // 新增
}>`
  // ...existing code...
  opacity: ${({ stepStatus, isViewed }) => {
    if (stepStatus === "generating") return 0.85;
    if (stepStatus === "generated") return 0.7;
    if (!isViewed) return 0.8; // 未查看过的步骤稍微透明
    return 1;
  }};
  // ...existing code...
`;

const TitleContent = styled.div<{ isViewed?: boolean }>`
  display: flex;
  align-items: center;
  flex: 1;
  font-weight: ${({ isViewed }) => isViewed ? '400' : '500'}; // 查看过的稍微减轻字重
`;

// 在组件中使用
interface StepTitleBarProps {
  // ...existing props...
  isViewed?: boolean; // 新增：是否已查看过
}

const StepTitleBar: React.FC<StepTitleBarProps> = ({ 
  // ...existing props...
  isViewed = false,
}) => {
  return (
    <TitleBarContainer 
      isActive={isActive} 
      isExpanded={isExpanded}
      isHighlighted={isHighlighted}
      isFlickering={isFlickering}
      stepStatus={stepStatus}
      isViewed={isViewed}
      onClick={onToggle}
    >
      <TitleContent isViewed={isViewed}>
        <ViewedIndicator isViewed={isViewed} />
        {highLevelStepIndex && (
          <HighLevelStepBadge stepStatus={stepStatus}>
            {highLevelStepIndex}
          </HighLevelStepBadge>
        )}
        <span>{title}</span>
      </TitleContent>
      {/* ...existing IconContainer... */}
    </TitleBarContainer>
  );
};
````

## 方案2：边框样式变化

通过改变边框样式来区分已查看和未查看的状态：

````tsx
// ...existing code...

const TitleBarContainer = styled.div<{ 
  isActive: boolean; 
  isExpanded: boolean; 
  isHighlighted: boolean; 
  isFlickering: boolean; 
  stepStatus?: StepStatus;
  isViewed?: boolean;
}>`
  // ...existing code...
  border: 2px solid ${({ isHighlighted, isFlickering, isViewed }) => {
    if (isFlickering) return '#FFD700';
    if (isHighlighted) return '#007ACC';
    if (isViewed) return `${lightGray}66`; // 查看过的边框更浅
    return `${lightGray}33`; // 未查看的保持原样
  }};
  border-left: 4px solid ${({ isViewed }) => {
    if (isViewed) return '#22C55E'; // 查看过的显示绿色左边框
    return 'transparent';
  }};
  // ...existing code...
`;
````

## 方案3：图标状态指示

在右侧图标区域添加查看状态指示：

````tsx
import { ArrowPathIcon, ChevronDownIcon, PlayIcon, EyeIcon } from '@heroicons/react/24/outline';
// ...existing code...

const ViewStatusIcon = styled.div<{ isViewed: boolean }>`
  display: flex;
  align-items: center;
  color: ${({ isViewed }) => isViewed ? '#22C55E' : '#666666'};
  opacity: ${({ isViewed }) => isViewed ? 1 : 0.4};
  transition: all 0.2s ease-in-out;
`;

// 在IconContainer中添加
<IconContainer>
  <ViewStatusIcon isViewed={isViewed} title={isViewed ? "已查看" : "未查看"}>
    <EyeIcon width={14} height={14} />
  </ViewStatusIcon>
  <IconButton 
    onClick={handleButtonClick} 
    disabled={isButtonDisabled}
    stepStatus={stepStatus}
    title={getTooltipText()}
  >
    {/* ...existing button content... */}
  </IconButton>
  <ChevronContainer isExpanded={isExpanded}>
    <ChevronDownIcon width={16} height={16} />
  </ChevronContainer>
</IconContainer>
````

## 方案4：背景渐变指示（微妙）

通过微妙的背景变化来指示查看状态：

````tsx
// ...existing code...

const TitleBarContainer = styled.div<{ 
  isActive: boolean; 
  isExpanded: boolean; 
  isHighlighted: boolean; 
  isFlickering: boolean; 
  stepStatus?: StepStatus;
  isViewed?: boolean;
}>`
  // ...existing code...
  background: ${({ isActive, isViewed }) => {
    const baseColor = isActive ? vscListActiveBackground : vscInputBackground;
    if (isViewed) {
      return `linear-gradient(90deg, ${baseColor} 95%, #22C55E20 100%)`; // 右侧微妙的绿色渐变
    }
    return baseColor;
  }};
  // ...existing code...
`;
````

## 推荐使用方案1

我推荐使用**方案1（左侧指示器 + 透明度变化）**，因为：

1. **视觉清晰**：小圆点指示器直观易懂
2. **不干扰现有设计**：与现有的状态指示（高亮、闪烁等）兼容
3. **渐进式反馈**：未查看的步骤稍微透明，提醒用户关注
4. **符合用户习惯**：类似于邮件已读/未读的常见设计模式

使用时，您需要在父组件中根据 `knowledgeCardGenerationStatus` 来判断并传递 `isViewed` 属性。

---

_**User**_

请你应用方案1试试吧

---

_**Assistant**_

我将应用方案1来实现查看状态的指示器。让我为您修改代码： 
```

```

```

```

```

```

```

```

```

```

```

```
完成！我已经成功应用了方案1，添加了查看状态的指示器设计。以下是主要的改动：

## 主要变化：

1. **新增 `ViewedIndicator` 组件**：
   - 在标题栏左侧显示一个小圆点
   - 已查看：绿色实心圆点 (#22C55E)
   - 未查看：灰色空心圆点 (#666666)

2. **透明度变化**：
   - 未查看的步骤透明度为 0.8，略微透明提醒用户关注
   - 已查看的步骤保持完全不透明 (1.0)

3. **字重调整**：
   - 已查看的步骤字重稍微减轻 (400)
   - 未查看的步骤保持较重字重 (500)

4. **新增 `isViewed` 属性**：
   - 在接口和组件中添加了 `isViewed?: boolean` 属性
   - 默认值为 `false`

## 使用方式：

在父组件中，您只需要根据 `knowledgeCardGenerationStatus` 来判断并传递 `isViewed` 属性：

```tsx
<StepTitleBar
  title={stepTitle}
  isViewed={knowledgeCardGenerationStatus === 'generated'} // 或者根据您的逻辑判断
  // ...其他属性
/>
```

这个设计既清晰又不会过度干扰现有的UI，用户可以一目了然地看到哪些步骤已经查看过了。

---

_**User**_

那请将这个判断加上，使得是否查看过能够明显一些

---

_**Assistant**_

我需要在Step组件中添加`isViewed`的判断逻辑，并将其传递给StepTitleBar。让我来修改Step.tsx文件： 
```

```
我需要先检查KnowledgeCardGenerationStatus的类型定义，让我查看一下： 现在我看到了KnowledgeCardGenerationStatus的类型定义，它只有三个值："empty" | "generating" | "checked"。根据逻辑，当状态为"checked"时表示知识卡片主题已经生成并检查过，可以认为step已经被查看过了。让我修正这个判断： 
```

```
完成！现在查看状态的判断逻辑已经正确添加了。

## 修改总结：

我在Step组件的StepTitleBar中添加了`isViewed`属性：

```tsx
isViewed={knowledgeCardGenerationStatus === "checked"}
```

## 逻辑说明：

根据`KnowledgeCardGenerationStatus`的类型定义，它有三个状态：
- `"empty"`：初始状态，没有生成知识卡片主题
- `"generating"`：正在生成知识卡片主题
- `"checked"`：知识卡片主题已生成并检查完毕

当状态为`"checked"`时，表示用户已经展开过这个step并且知识卡片主题已经生成完成，可以认为这个step已经被查看过了。

## 视觉效果：

现在用户可以通过以下视觉指示器来判断哪些step已经查看过：

1. **左侧圆点指示器**：
   - 已查看：绿色实心圆点
   - 未查看：灰色空心圆点

2. **透明度变化**：
   - 已查看：完全不透明
   - 未查看：稍微透明（0.8透明度）

3. **字重调整**：
   - 已查看：较轻字重（400）
   - 未查看：较重字重（500）

这样用户就能很清楚地看到自己查看过哪些step了！

---

