# Step_Dirty åŠŸèƒ½å®ç°å®Œæˆæ€»ç»“

## ğŸ‰ åŠŸèƒ½çŠ¶æ€
âœ… **å·²æˆåŠŸå®ç°å¹¶æµ‹è¯•é€šè¿‡**

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°
å®ç°äº†å½“ç”¨æˆ·ç¼–è¾‘å·²ç”Ÿæˆ(generated)çš„stepæ—¶ï¼Œèƒ½å¤Ÿæ­£ç¡®æ˜¾ç¤º`step_dirty`çŠ¶æ€ï¼Œè¡¨ç¤ºstepå†…å®¹å·²è¢«ä¿®æ”¹ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆç›¸å…³ä¿¡æ¯ã€‚

## ğŸ›  æ ¸å¿ƒå®ç°

### 1. ç±»å‹å®šä¹‰æ‰©å±•
åœ¨`index.d.ts`ä¸­ä¸º`StepItem`æ¥å£æ·»åŠ äº†`previousStepAbstract?`å­—æ®µï¼Œç”¨äºä¿å­˜åŸå§‹å†…å®¹ã€‚

### 2. Redux çŠ¶æ€ç®¡ç†
**æ–‡ä»¶**: `codeAwareSlice.ts`

#### setStepStatus å¢å¼º
- å½“stepè¿›å…¥"editing"çŠ¶æ€æ—¶ï¼Œè‡ªåŠ¨ä¿å­˜å½“å‰abstractåˆ°`previousStepAbstract`
- æ”¯æŒä»"generated"å’Œ"step_dirty"çŠ¶æ€è¿›å…¥ç¼–è¾‘æ¨¡å¼

#### setStepAbstract æ™ºèƒ½çŠ¶æ€æ£€æµ‹
- **ä»"generated"çŠ¶æ€**: å†…å®¹å˜åŒ–æ—¶è®¾ç½®ä¸º"step_dirty"
- **ä»"step_dirty"çŠ¶æ€**: å†…å®¹æ¢å¤åˆ°åŸå§‹æ—¶è®¾ç½®ä¸º"generated" 
- **ä»"editing"çŠ¶æ€**: æ ¹æ®å†…å®¹ä¸åŸå§‹å†…å®¹çš„æ¯”è¾ƒæ™ºèƒ½ç¡®å®šæœ€ç»ˆçŠ¶æ€

### 3. UI ç»„ä»¶æ›´æ–°
**æ–‡ä»¶**: `Step.tsx`, `StepTitleBar.tsx`

- ç¼–è¾‘æŒ‰é’®ç°åœ¨åœ¨"generated"å’Œ"step_dirty"çŠ¶æ€ä¸‹éƒ½å¯è§
- åˆ·æ–°æŒ‰é’®(ArrowPathIcon)åœ¨"step_dirty"çŠ¶æ€ä¸‹æ˜¾ç¤º
- ç§»é™¤äº†ç¼–è¾‘ç¡®è®¤åå¼ºåˆ¶è®¾ç½®"confirmed"çŠ¶æ€çš„é€»è¾‘

### 4. ä¸»å®¹å™¨ç»„ä»¶
**æ–‡ä»¶**: `CodeAware.tsx`

- å®ç°äº†`handleStepEdit`å’Œ`handleStepStatusChange`å›è°ƒ
- ç®€åŒ–äº†é€»è¾‘ï¼Œè®©Redux sliceæ™ºèƒ½å¤„ç†çŠ¶æ€è½¬æ¢

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

### åœºæ™¯1: ç¼–è¾‘å¹¶ä¿®æ”¹å†…å®¹
1. **åˆå§‹**: StepçŠ¶æ€ä¸º"generated"ï¼Œå†…å®¹ä¸º"åŸå§‹å†…å®¹"
2. **ç‚¹å‡»ç¼–è¾‘**: çŠ¶æ€å˜ä¸º"editing"ï¼Œä¿å­˜`previousStepAbstract = "åŸå§‹å†…å®¹"`
3. **ä¿®æ”¹å†…å®¹**: ç”¨æˆ·ç¼–è¾‘ä¸º"æ–°å†…å®¹"
4. **ç¡®è®¤ç¼–è¾‘**: `setStepAbstract`æ£€æµ‹åˆ°å†…å®¹å˜åŒ–ï¼Œè®¾ç½®çŠ¶æ€ä¸º"step_dirty"
5. **ç»“æœ**: æ˜¾ç¤ºåˆ·æ–°æŒ‰é’®ï¼Œç”¨æˆ·å¯ä»¥é‡æ–°ç”Ÿæˆç›¸å…³ä¿¡æ¯

### åœºæ™¯2: ç¼–è¾‘ä½†ä¸ä¿®æ”¹å†…å®¹
1. **åˆå§‹**: StepçŠ¶æ€ä¸º"generated"
2. **ç¼–è¾‘è¿‡ç¨‹**: åŒä¸Šï¼Œä½†ç”¨æˆ·æœªä¿®æ”¹å†…å®¹
3. **ç¡®è®¤ç¼–è¾‘**: `setStepAbstract`æ£€æµ‹åˆ°å†…å®¹æœªå˜åŒ–ï¼ŒçŠ¶æ€ä¿æŒ"generated"

### åœºæ™¯3: ä»step_dirtyæ¢å¤åˆ°åŸå§‹å†…å®¹
1. **åˆå§‹**: StepçŠ¶æ€ä¸º"step_dirty"ï¼Œæœ‰`previousStepAbstract`
2. **ç¼–è¾‘**: ç”¨æˆ·å°†å†…å®¹æ”¹å›ä¸`previousStepAbstract`ç›¸åŒ
3. **ç¡®è®¤ç¼–è¾‘**: çŠ¶æ€æ¢å¤ä¸º"generated"ï¼Œæ¸…é™¤`previousStepAbstract`

## ğŸ¯ å…³é”®è®¾è®¡å†³ç­–

### 1. çŠ¶æ€æ™ºèƒ½æ£€æµ‹
ä¸å†æ‰‹åŠ¨è®¾ç½®æœ€ç»ˆçŠ¶æ€ï¼Œè€Œæ˜¯è®©`setStepAbstract`æ ¹æ®å†…å®¹å˜åŒ–æ™ºèƒ½ç¡®å®šçŠ¶æ€ã€‚

### 2. åŸå§‹å†…å®¹ä¿å­˜æ—¶æœº
åœ¨è¿›å…¥ç¼–è¾‘çŠ¶æ€æ—¶ä¿å­˜ï¼Œè€Œä¸æ˜¯åœ¨å†…å®¹å˜åŒ–æ—¶ä¿å­˜ï¼Œç¡®ä¿å§‹ç»ˆæœ‰æ­£ç¡®çš„æ¯”è¾ƒåŸºå‡†ã€‚

### 3. åŒå‘çŠ¶æ€è½¬æ¢
æ”¯æŒ`generated` â†” `step_dirty`çš„åŒå‘è½¬æ¢ï¼Œç”¨æˆ·å¯ä»¥è‡ªç”±ç¼–è¾‘å’Œæ¢å¤ã€‚

## ğŸ§¹ ä»£ç æ¸…ç†
å·²ç§»é™¤æ‰€æœ‰è°ƒè¯•ä¿¡æ¯ï¼Œä¿æŒä»£ç ç®€æ´å¹²å‡€ã€‚

## ğŸš€ åç»­æ‰©å±•
- å¯ä»¥åŸºäºæ­¤æ¶æ„å®ç°`code_dirty`çŠ¶æ€
- å¯ä»¥åœ¨`handleRerunStep`ä¸­å®ç°å…·ä½“çš„LLMé‡æ–°ç”Ÿæˆé€»è¾‘
- å¯ä»¥æ·»åŠ æ›´å¤šçš„çŠ¶æ€è½¬æ¢è§„åˆ™

## ğŸ“ ä¿®æ”¹æ–‡ä»¶åˆ—è¡¨
- `core/index.d.ts` - æ·»åŠ previousStepAbstractå­—æ®µ
- `gui/src/redux/slices/codeAwareSlice.ts` - æ ¸å¿ƒçŠ¶æ€ç®¡ç†é€»è¾‘
- `gui/src/pages/codeaware/components/Steps/Step.tsx` - UIç»„ä»¶é€»è¾‘
- `gui/src/pages/codeaware/components/Steps/StepTitleBar.tsx` - æŒ‰é’®æ˜¾ç¤ºé€»è¾‘  
- `gui/src/pages/codeaware/CodeAware.tsx` - ä¸»å®¹å™¨å›è°ƒå¤„ç†

åŠŸèƒ½ç°åœ¨å®Œå…¨å¯ç”¨ï¼Œç”¨æˆ·å¯ä»¥æ­£å¸¸ç¼–è¾‘generatedçŠ¶æ€çš„stepså¹¶çœ‹åˆ°æ­£ç¡®çš„step_dirtyçŠ¶æ€æŒ‡ç¤ºï¼
